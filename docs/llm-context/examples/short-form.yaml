# Short-Form Video Workflow (60 seconds)
# For TikTok, YouTube Shorts, Instagram Reels

version: 1
name: "Short Form Explainer"
description: "60-second vertical video with hook, content, and CTA"

vars:
  project_name: "Demo Short"
  orientation: portrait
  tts_server: "http://curiosity:7860"
  flux_server: "http://192.168.1.64:8570"
  voice_ref: "assets/voice-reference.wav"
  voice_text: "Sample voice reference transcript goes here."

segments:
  - id: title
    segment_type: music_only
    description: "Opening title card with music"
    steps: [create_title_slide, animate_title]

  - id: hook
    segment_type: narration_only
    description: "Attention-grabbing opening hook"
    steps: [write_hook, tts_hook, gen_hook_bg, make_hook_clip]

  - id: content
    segment_type: narration_only
    description: "Main content and value proposition"
    steps: [write_content, tts_content, gen_content_bg, make_content_clip]

  - id: cta
    segment_type: narration_only
    description: "Call to action"
    steps: [write_cta, tts_cta, gen_cta_bg, make_cta_clip]

steps:
  # === SETUP ===
  - id: setup_dirs
    kind: ensure_dirs
    dirs:
      - "work/scripts"
      - "work/audio"
      - "work/images"
      - "work/clips"
      - "output"

  # === TITLE SEGMENT (music_only) ===
  - id: create_title_slide
    kind: create_slide
    resume_output: "work/images/title.png"
    template: title
    text: "{{project_name}}"
    subtext: "Watch till the end!"
    output_path: "work/images/title.png"
    orientation: "{{orientation}}"

  - id: animate_title
    kind: image_to_video
    resume_output: "work/clips/title.mp4"
    input_path: "work/images/title.png"
    output_path: "work/clips/title.mp4"
    frames: 14
    motion: 60

  # === HOOK SEGMENT (narration_only) ===
  - id: write_hook
    kind: write_file
    path: "work/scripts/hook.txt"
    content: |
      What if I told you there's a better way?
      Most people struggle with this every single day.

  - id: tts_hook
    kind: tts_generate
    resume_output: "work/audio/hook.wav"
    script_path: "work/scripts/hook.txt"
    output_path: "work/audio/hook.wav"
    server: "{{tts_server}}"
    reference_audio: "{{voice_ref}}"
    reference_text: "{{voice_text}}"

  - id: gen_hook_bg
    kind: text_to_image
    resume_output: "work/images/hook.png"
    prompt: "Person looking confused at complex interface, dramatic lighting, vertical composition"
    output_path: "work/images/hook.png"
    orientation: "{{orientation}}"
    server: "{{flux_server}}"

  - id: make_hook_clip
    kind: run_command
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/hook.png", "-i", "work/audio/hook.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/hook.mp4"]

  # === CONTENT SEGMENT (narration_only) ===
  - id: write_content
    kind: write_file
    path: "work/scripts/content.txt"
    content: |
      Here's the solution.
      It takes just three simple steps.
      First, set up your configuration.
      Second, run the automation.
      Third, enjoy the results.

  - id: tts_content
    kind: tts_generate
    resume_output: "work/audio/content.wav"
    script_path: "work/scripts/content.txt"
    output_path: "work/audio/content.wav"
    server: "{{tts_server}}"
    reference_audio: "{{voice_ref}}"
    reference_text: "{{voice_text}}"

  - id: gen_content_bg
    kind: text_to_image
    resume_output: "work/images/content.png"
    prompt: "Clean modern interface showing simple workflow, bright colors, vertical composition"
    output_path: "work/images/content.png"
    orientation: "{{orientation}}"
    server: "{{flux_server}}"

  - id: make_content_clip
    kind: run_command
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/content.png", "-i", "work/audio/content.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/content.mp4"]

  # === CTA SEGMENT (narration_only) ===
  - id: write_cta
    kind: write_file
    path: "work/scripts/cta.txt"
    content: |
      Try it yourself today.
      Link in bio. Follow for more tips!

  - id: tts_cta
    kind: tts_generate
    resume_output: "work/audio/cta.wav"
    script_path: "work/scripts/cta.txt"
    output_path: "work/audio/cta.wav"
    server: "{{tts_server}}"
    reference_audio: "{{voice_ref}}"
    reference_text: "{{voice_text}}"

  - id: gen_cta_bg
    kind: text_to_image
    resume_output: "work/images/cta.png"
    prompt: "Call to action screen with arrow pointing down, engaging colors, vertical composition"
    output_path: "work/images/cta.png"
    orientation: "{{orientation}}"
    server: "{{flux_server}}"

  - id: make_cta_clip
    kind: run_command
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/cta.png", "-i", "work/audio/cta.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/cta.mp4"]

  # === NORMALIZE AUDIO ===
  - id: normalize_hook
    kind: normalize_volume
    clip_path: "work/clips/hook.mp4"
    target_db: -25

  - id: normalize_content
    kind: normalize_volume
    clip_path: "work/clips/content.mp4"
    target_db: -25

  - id: normalize_cta
    kind: normalize_volume
    clip_path: "work/clips/cta.mp4"
    target_db: -25

  # === FINAL ASSEMBLY ===
  - id: concat_final
    kind: video_concat
    clips:
      - "work/clips/title.mp4"
      - "work/clips/hook.mp4"
      - "work/clips/content.mp4"
      - "work/clips/cta.mp4"
    output_path: "output/{{project_name}}.mp4"
    reencode: true
