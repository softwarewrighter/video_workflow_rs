# Tutorial Video Workflow (5-10 minutes)
# For documentation, how-to guides, educational content

version: 1
name: "Setup Tutorial"
description: "Step-by-step tutorial with narration and generated visuals"

vars:
  topic: "Getting Started"
  product: "MyTool"
  orientation: landscape
  tts_server: "http://curiosity:7860"
  flux_server: "http://192.168.1.64:8570"
  voice_ref: "assets/voice-reference.wav"
  voice_text: "This is my voice reference for text to speech generation."

segments:
  - id: intro
    segment_type: narration_only
    description: "Introduction and overview"
    steps: [write_intro, tts_intro, gen_intro_visual, make_intro_clip]

  - id: prereqs
    segment_type: narration_only
    description: "Prerequisites and requirements"
    steps: [write_prereqs, tts_prereqs, gen_prereqs_visual, make_prereqs_clip]

  - id: step1
    segment_type: narration_only
    description: "First step - Installation"
    steps: [write_step1, tts_step1, gen_step1_visual, make_step1_clip]

  - id: step2
    segment_type: narration_only
    description: "Second step - Configuration"
    steps: [write_step2, tts_step2, gen_step2_visual, make_step2_clip]

  - id: step3
    segment_type: narration_only
    description: "Third step - First run"
    steps: [write_step3, tts_step3, gen_step3_visual, make_step3_clip]

  - id: conclusion
    segment_type: narration_only
    description: "Summary and next steps"
    steps: [write_conclusion, tts_conclusion, gen_conclusion_visual, make_conclusion_clip]

steps:
  # === SETUP ===
  - id: setup_dirs
    kind: ensure_dirs
    dirs:
      - "work/scripts"
      - "work/audio"
      - "work/images"
      - "work/clips"
      - "output"

  # === INTRO ===
  - id: write_intro
    kind: write_file
    path: "work/scripts/intro.txt"
    content: |
      Welcome to this tutorial on {{topic}} with {{product}}.
      In this video, I'll walk you through the complete setup process.
      By the end, you'll have a fully working installation.
      Let's get started.

  - id: tts_intro
    kind: tts_generate
    resume_output: "work/audio/intro.wav"
    script_path: "work/scripts/intro.txt"
    output_path: "work/audio/intro.wav"
    server: "{{tts_server}}"
    reference_audio: "{{voice_ref}}"
    reference_text: "{{voice_text}}"

  - id: gen_intro_visual
    kind: text_to_image
    resume_output: "work/images/intro.png"
    prompt: "Clean tutorial title card with text 'Getting Started', modern tech design, blue gradient background"
    output_path: "work/images/intro.png"
    orientation: "{{orientation}}"
    server: "{{flux_server}}"

  - id: make_intro_clip
    kind: run_command
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/intro.png", "-i", "work/audio/intro.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/intro.mp4"]

  # === PREREQUISITES ===
  - id: write_prereqs
    kind: write_file
    path: "work/scripts/prereqs.txt"
    content: |
      Before we begin, let's make sure you have everything you need.
      You'll need a computer running Windows, Mac, or Linux.
      You should have administrator access for installation.
      And you'll need about 500 megabytes of free disk space.
      If you have all of that, you're ready to proceed.

  - id: tts_prereqs
    kind: tts_generate
    resume_output: "work/audio/prereqs.wav"
    script_path: "work/scripts/prereqs.txt"
    output_path: "work/audio/prereqs.wav"
    server: "{{tts_server}}"
    reference_audio: "{{voice_ref}}"
    reference_text: "{{voice_text}}"

  - id: gen_prereqs_visual
    kind: text_to_image
    resume_output: "work/images/prereqs.png"
    prompt: "Checklist graphic with checkmarks, prerequisites concept, clean documentation style, blue and white"
    output_path: "work/images/prereqs.png"
    orientation: "{{orientation}}"
    server: "{{flux_server}}"

  - id: make_prereqs_clip
    kind: run_command
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/prereqs.png", "-i", "work/audio/prereqs.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/prereqs.mp4"]

  # === STEP 1: INSTALLATION ===
  - id: write_step1
    kind: write_file
    path: "work/scripts/step1.txt"
    content: |
      Step one: Installation.
      First, download the installer from our website.
      Once downloaded, run the installer.
      Follow the prompts to complete the installation.
      The whole process takes about two minutes.
      When it's done, you'll see a success message.

  - id: tts_step1
    kind: tts_generate
    resume_output: "work/audio/step1.wav"
    script_path: "work/scripts/step1.txt"
    output_path: "work/audio/step1.wav"
    server: "{{tts_server}}"
    reference_audio: "{{voice_ref}}"
    reference_text: "{{voice_text}}"

  - id: gen_step1_visual
    kind: text_to_image
    resume_output: "work/images/step1.png"
    prompt: "Software installation wizard dialog box, download progress bar, clean UI mockup"
    output_path: "work/images/step1.png"
    orientation: "{{orientation}}"
    server: "{{flux_server}}"

  - id: make_step1_clip
    kind: run_command
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/step1.png", "-i", "work/audio/step1.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/step1.mp4"]

  # === STEP 2: CONFIGURATION ===
  - id: write_step2
    kind: write_file
    path: "work/scripts/step2.txt"
    content: |
      Step two: Configuration.
      Open the application for the first time.
      You'll see a setup wizard.
      Enter your name and email address.
      Choose your preferred settings.
      Click save to apply the configuration.
      The application will restart with your settings applied.

  - id: tts_step2
    kind: tts_generate
    resume_output: "work/audio/step2.wav"
    script_path: "work/scripts/step2.txt"
    output_path: "work/audio/step2.wav"
    server: "{{tts_server}}"
    reference_audio: "{{voice_ref}}"
    reference_text: "{{voice_text}}"

  - id: gen_step2_visual
    kind: text_to_image
    resume_output: "work/images/step2.png"
    prompt: "Settings panel with form fields, configuration interface, modern app design, clean UI"
    output_path: "work/images/step2.png"
    orientation: "{{orientation}}"
    server: "{{flux_server}}"

  - id: make_step2_clip
    kind: run_command
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/step2.png", "-i", "work/audio/step2.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/step2.mp4"]

  # === STEP 3: FIRST RUN ===
  - id: write_step3
    kind: write_file
    path: "work/scripts/step3.txt"
    content: |
      Step three: Your first run.
      Now let's test that everything works.
      Click the start button in the main window.
      You should see a progress indicator.
      After a few seconds, you'll see the results.
      If you see the success screen, congratulations!
      You've successfully set up {{product}}.

  - id: tts_step3
    kind: tts_generate
    resume_output: "work/audio/step3.wav"
    script_path: "work/scripts/step3.txt"
    output_path: "work/audio/step3.wav"
    server: "{{tts_server}}"
    reference_audio: "{{voice_ref}}"
    reference_text: "{{voice_text}}"

  - id: gen_step3_visual
    kind: text_to_image
    resume_output: "work/images/step3.png"
    prompt: "Success screen with green checkmark, completed task notification, celebration UI design"
    output_path: "work/images/step3.png"
    orientation: "{{orientation}}"
    server: "{{flux_server}}"

  - id: make_step3_clip
    kind: run_command
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/step3.png", "-i", "work/audio/step3.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/step3.mp4"]

  # === CONCLUSION ===
  - id: write_conclusion
    kind: write_file
    path: "work/scripts/conclusion.txt"
    content: |
      And that's it! You've completed the setup.
      Let me quickly recap what we covered.
      First, we installed the software.
      Then, we configured your preferences.
      Finally, we ran your first test.
      For more tutorials, check out our documentation.
      Thanks for watching, and happy coding!

  - id: tts_conclusion
    kind: tts_generate
    resume_output: "work/audio/conclusion.wav"
    script_path: "work/scripts/conclusion.txt"
    output_path: "work/audio/conclusion.wav"
    server: "{{tts_server}}"
    reference_audio: "{{voice_ref}}"
    reference_text: "{{voice_text}}"

  - id: gen_conclusion_visual
    kind: text_to_image
    resume_output: "work/images/conclusion.png"
    prompt: "Thank you screen with thumbs up icon, end of tutorial graphic, friendly professional design"
    output_path: "work/images/conclusion.png"
    orientation: "{{orientation}}"
    server: "{{flux_server}}"

  - id: make_conclusion_clip
    kind: run_command
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/conclusion.png", "-i", "work/audio/conclusion.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/conclusion.mp4"]

  # === NORMALIZE ALL CLIPS ===
  - id: normalize_intro
    kind: normalize_volume
    clip_path: "work/clips/intro.mp4"
    target_db: -25

  - id: normalize_prereqs
    kind: normalize_volume
    clip_path: "work/clips/prereqs.mp4"
    target_db: -25

  - id: normalize_step1
    kind: normalize_volume
    clip_path: "work/clips/step1.mp4"
    target_db: -25

  - id: normalize_step2
    kind: normalize_volume
    clip_path: "work/clips/step2.mp4"
    target_db: -25

  - id: normalize_step3
    kind: normalize_volume
    clip_path: "work/clips/step3.mp4"
    target_db: -25

  - id: normalize_conclusion
    kind: normalize_volume
    clip_path: "work/clips/conclusion.mp4"
    target_db: -25

  # === FINAL ASSEMBLY ===
  - id: concat_final
    kind: video_concat
    clips:
      - "work/clips/intro.mp4"
      - "work/clips/prereqs.mp4"
      - "work/clips/step1.mp4"
      - "work/clips/step2.mp4"
      - "work/clips/step3.mp4"
      - "work/clips/conclusion.mp4"
    output_path: "output/{{product}}_tutorial.mp4"
    reencode: true
