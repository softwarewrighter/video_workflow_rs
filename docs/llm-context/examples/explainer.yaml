# Product Explainer Video Workflow (2-3 minutes)
# For YouTube, landing pages, marketing

version: 1
name: "Product Explainer"
description: "Professional explainer video with intro, problem, solution, demo, and CTA"

vars:
  product_name: "MyProduct"
  tagline: "Simplify Your Workflow"
  orientation: landscape
  tts_server: "http://curiosity:7860"
  flux_server: "http://192.168.1.64:8570"
  ttv_server: "http://192.168.1.64:6000"
  voice_ref: "assets/voice-reference.wav"
  voice_text: "This is a sample of my voice for the text to speech system."

segments:
  - id: intro
    segment_type: music_only
    description: "Animated logo/title with background music"
    steps: [gen_title_video, add_intro_music]

  - id: hook
    segment_type: narration_only
    description: "Problem statement to grab attention"
    steps: [write_hook, tts_hook, gen_hook_visual, make_hook_clip]

  - id: problem
    segment_type: narration_only
    description: "Deep dive into the problem"
    steps: [write_problem, tts_problem, gen_problem_visual, make_problem_clip]

  - id: solution
    segment_type: narration_only
    description: "Introduce the solution"
    steps: [write_solution, tts_solution, gen_solution_visual, make_solution_clip]

  - id: features
    segment_type: narration_only
    description: "Key features and benefits"
    steps: [write_features, tts_features, gen_features_visual, make_features_clip]

  - id: cta
    segment_type: narration_only
    description: "Call to action"
    steps: [write_cta, tts_cta, gen_cta_visual, make_cta_clip]

  - id: outro
    segment_type: music_only
    description: "Logo with background music"
    steps: [gen_outro_slide, animate_outro, add_outro_music]

steps:
  # === SETUP ===
  - id: setup_dirs
    kind: ensure_dirs
    dirs:
      - "work/scripts"
      - "work/audio"
      - "work/images"
      - "work/videos"
      - "work/clips"
      - "output"

  # === GENERATE MUSIC ===
  - id: gen_music
    kind: run_command
    program: midi-cli-rs
    args:
      - "--mood"
      - "ambient"
      - "--seed"
      - "2026"
      - "--duration"
      - "180"
      - "--soundfont"
      - "/usr/share/soundfonts/FluidR3_GM.sf2"
      - "--output"
      - "work/audio/background.wav"

  # === INTRO SEGMENT (music_only) ===
  - id: gen_title_video
    kind: text_to_video
    resume_output: "work/videos/title.mp4"
    prompt: "Modern tech company logo animation, professional blue and white, smooth motion, corporate style"
    output_path: "work/videos/title.mp4"
    orientation: "{{orientation}}"
    length: 81
    server: "{{ttv_server}}"

  - id: add_intro_music
    kind: audio_mix
    base_clip: "work/videos/title.mp4"
    overlay_audio: "work/audio/background.wav"
    output_path: "work/clips/intro.mp4"
    overlay_volume: -20
    fade_out: 1.0

  # === HOOK SEGMENT (narration_only) ===
  - id: write_hook
    kind: write_file
    path: "work/scripts/hook.txt"
    content: |
      Are you tired of spending hours on repetitive tasks?
      What if there was a better way?

  - id: tts_hook
    kind: tts_generate
    resume_output: "work/audio/hook.wav"
    script_path: "work/scripts/hook.txt"
    output_path: "work/audio/hook.wav"
    server: "{{tts_server}}"
    reference_audio: "{{voice_ref}}"
    reference_text: "{{voice_text}}"

  - id: gen_hook_visual
    kind: text_to_image
    resume_output: "work/images/hook.png"
    prompt: "Frustrated business person at desk with pile of papers, dramatic lighting, professional photography"
    output_path: "work/images/hook.png"
    orientation: "{{orientation}}"
    server: "{{flux_server}}"

  - id: make_hook_clip
    kind: run_command
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/hook.png", "-i", "work/audio/hook.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/hook.mp4"]

  # === PROBLEM SEGMENT (narration_only) ===
  - id: write_problem
    kind: write_file
    path: "work/scripts/problem.txt"
    content: |
      Every day, professionals waste valuable time on manual processes.
      Data entry, file management, repetitive approvals.
      These tasks add up to hours lost every week.
      Hours you could spend on work that actually matters.

  - id: tts_problem
    kind: tts_generate
    resume_output: "work/audio/problem.wav"
    script_path: "work/scripts/problem.txt"
    output_path: "work/audio/problem.wav"
    server: "{{tts_server}}"
    reference_audio: "{{voice_ref}}"
    reference_text: "{{voice_text}}"

  - id: gen_problem_visual
    kind: text_to_image
    resume_output: "work/images/problem.png"
    prompt: "Clock melting like Dali painting with scattered papers, time management concept, surreal business art"
    output_path: "work/images/problem.png"
    orientation: "{{orientation}}"
    server: "{{flux_server}}"

  - id: make_problem_clip
    kind: run_command
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/problem.png", "-i", "work/audio/problem.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/problem.mp4"]

  # === SOLUTION SEGMENT (narration_only) ===
  - id: write_solution
    kind: write_file
    path: "work/scripts/solution.txt"
    content: |
      Introducing {{product_name}}.
      {{tagline}}.
      With {{product_name}}, you can automate the tasks that slow you down.
      Set it up once, and let it work for you.

  - id: tts_solution
    kind: tts_generate
    resume_output: "work/audio/solution.wav"
    script_path: "work/scripts/solution.txt"
    output_path: "work/audio/solution.wav"
    server: "{{tts_server}}"
    reference_audio: "{{voice_ref}}"
    reference_text: "{{voice_text}}"

  - id: gen_solution_visual
    kind: text_to_image
    resume_output: "work/images/solution.png"
    prompt: "Modern clean software dashboard with automation workflows, bright UI design, professional screenshot style"
    output_path: "work/images/solution.png"
    orientation: "{{orientation}}"
    server: "{{flux_server}}"

  - id: make_solution_clip
    kind: run_command
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/solution.png", "-i", "work/audio/solution.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/solution.mp4"]

  # === FEATURES SEGMENT (narration_only) ===
  - id: write_features
    kind: write_file
    path: "work/scripts/features.txt"
    content: |
      Here's what makes {{product_name}} different.
      First, it's incredibly easy to set up. No coding required.
      Second, it integrates with all the tools you already use.
      And third, it learns from your workflows and gets smarter over time.
      The result? You save hours every single week.

  - id: tts_features
    kind: tts_generate
    resume_output: "work/audio/features.wav"
    script_path: "work/scripts/features.txt"
    output_path: "work/audio/features.wav"
    server: "{{tts_server}}"
    reference_audio: "{{voice_ref}}"
    reference_text: "{{voice_text}}"

  - id: gen_features_visual
    kind: text_to_image
    resume_output: "work/images/features.png"
    prompt: "Isometric illustration of connected software systems, integration diagram, modern tech aesthetic"
    output_path: "work/images/features.png"
    orientation: "{{orientation}}"
    server: "{{flux_server}}"

  - id: make_features_clip
    kind: run_command
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/features.png", "-i", "work/audio/features.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/features.mp4"]

  # === CTA SEGMENT (narration_only) ===
  - id: write_cta
    kind: write_file
    path: "work/scripts/cta.txt"
    content: |
      Ready to reclaim your time?
      Start your free trial of {{product_name}} today.
      Visit our website to get started.
      Your future self will thank you.

  - id: tts_cta
    kind: tts_generate
    resume_output: "work/audio/cta.wav"
    script_path: "work/scripts/cta.txt"
    output_path: "work/audio/cta.wav"
    server: "{{tts_server}}"
    reference_audio: "{{voice_ref}}"
    reference_text: "{{voice_text}}"

  - id: gen_cta_visual
    kind: text_to_image
    resume_output: "work/images/cta.png"
    prompt: "Happy professional at clean desk with laptop, productive workspace, warm lighting, lifestyle photography"
    output_path: "work/images/cta.png"
    orientation: "{{orientation}}"
    server: "{{flux_server}}"

  - id: make_cta_clip
    kind: run_command
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/cta.png", "-i", "work/audio/cta.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/cta.mp4"]

  # === OUTRO SEGMENT (music_only) ===
  - id: gen_outro_slide
    kind: create_slide
    resume_output: "work/images/outro.png"
    template: title
    text: "{{product_name}}"
    subtext: "{{tagline}}"
    output_path: "work/images/outro.png"
    orientation: "{{orientation}}"

  - id: animate_outro
    kind: image_to_video
    resume_output: "work/videos/outro.mp4"
    input_path: "work/images/outro.png"
    output_path: "work/videos/outro.mp4"
    frames: 14
    motion: 40

  - id: add_outro_music
    kind: audio_mix
    base_clip: "work/videos/outro.mp4"
    overlay_audio: "work/audio/background.wav"
    output_path: "work/clips/outro.mp4"
    overlay_volume: -20
    fade_out: 2.0

  # === NORMALIZE AUDIO ===
  - id: normalize_hook
    kind: normalize_volume
    clip_path: "work/clips/hook.mp4"
    target_db: -25

  - id: normalize_problem
    kind: normalize_volume
    clip_path: "work/clips/problem.mp4"
    target_db: -25

  - id: normalize_solution
    kind: normalize_volume
    clip_path: "work/clips/solution.mp4"
    target_db: -25

  - id: normalize_features
    kind: normalize_volume
    clip_path: "work/clips/features.mp4"
    target_db: -25

  - id: normalize_cta
    kind: normalize_volume
    clip_path: "work/clips/cta.mp4"
    target_db: -25

  # === FINAL ASSEMBLY ===
  - id: concat_final
    kind: video_concat
    clips:
      - "work/clips/intro.mp4"
      - "work/clips/hook.mp4"
      - "work/clips/problem.mp4"
      - "work/clips/solution.mp4"
      - "work/clips/features.mp4"
      - "work/clips/cta.mp4"
      - "work/clips/outro.mp4"
    output_path: "output/{{product_name}}_explainer.mp4"
    reencode: true
