# Template: Explainer Video
# Format: 1920x1080 (16:9 landscape)
# Duration: 2-5 minutes
# Structure: Hook -> Problem -> Solution -> Features -> CTA

version: 1
name: "Explainer Video Template"
description: "Landscape explainer video for YouTube or landing pages"

vars:
  project_name: "Product Explainer"
  product: "the product"
  audience: "target audience"
  tts_server: "http://curiosity:7860"
  reference_audio: "assets/voice-reference.wav"
  reference_text: "This is my voice sample for cloning."
  python_path: ".venv/bin/python"

segments:
  - id: intro
    segment_type: music_only
    steps: [title_slide, title_video, music_intro]
  - id: hook
    segment_type: narration_only
    steps: [script_hook, tts_hook, img_hook, clip_hook]
  - id: problem
    segment_type: narration_only
    steps: [script_problem, tts_problem, img_problem, clip_problem]
  - id: solution
    segment_type: narration_only
    steps: [script_solution, tts_solution, img_solution, clip_solution]
  - id: features
    segment_type: narration_only
    steps: [script_features, tts_features, img_features, clip_features]
  - id: cta
    segment_type: narration_only
    steps: [script_cta, tts_cta, img_cta, clip_cta]
  - id: outro
    segment_type: music_only
    steps: [outro_slide, outro_video, music_outro]

steps:
  # === Setup ===
  - id: setup_dirs
    kind: ensure_dirs
    dirs:
      - "work/scripts"
      - "work/audio"
      - "work/images"
      - "work/clips"
      - "output"

  # === Intro (music only, 5s) ===
  - id: title_slide
    kind: create_slide
    depends_on: [setup_dirs]
    resume_output: "work/images/title.png"
    template: title
    text: "{{product}}"
    subtext: "The smarter way to work"
    output_path: "work/images/title.png"
    orientation: landscape

  - id: title_video
    kind: image_to_video
    depends_on: [title_slide]
    resume_output: "work/clips/title.mp4"
    input_path: "work/images/title.png"
    output_path: "work/clips/title.mp4"
    motion: 40

  - id: music_intro
    kind: run_command
    depends_on: [setup_dirs]
    resume_output: "work/audio/intro_music.wav"
    program: midi-cli-rs
    args: ["preset", "--mood", "upbeat", "--duration", "5", "-o", "work/audio/intro_music.wav"]

  # === Hook (15s) ===
  - id: script_hook
    kind: write_file
    depends_on: [setup_dirs]
    path: "work/scripts/hook.txt"
    content: |
      What if you could solve your biggest challenge in half the time?
      For {{audience}}, that challenge is real.
      And {{product}} was built to solve it.

  - id: tts_hook
    kind: tts_generate
    depends_on: [script_hook]
    resume_output: "work/audio/hook.wav"
    script_path: "work/scripts/hook.txt"
    output_path: "work/audio/hook.wav"
    server: "{{tts_server}}"
    reference_audio: "{{reference_audio}}"
    reference_text: "{{reference_text}}"
    python_path: "{{python_path}}"

  - id: img_hook
    kind: text_to_image
    depends_on: [setup_dirs]
    resume_output: "work/images/hook.png"
    prompt: "Professional person having an insight, modern office, warm lighting, landscape"
    output_path: "work/images/hook.png"
    orientation: landscape
    python_path: "{{python_path}}"

  - id: clip_hook
    kind: run_command
    depends_on: [tts_hook, img_hook]
    resume_output: "work/clips/hook.mp4"
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/hook.png", "-i", "work/audio/hook.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/hook.mp4"]

  # === Problem (20s) ===
  - id: script_problem
    kind: write_file
    depends_on: [setup_dirs]
    path: "work/scripts/problem.txt"
    content: |
      Traditional approaches to this problem are slow, complex, and frustrating.
      You spend hours on tasks that should take minutes.
      And the tools you have just were not designed for the way you work.

  - id: tts_problem
    kind: tts_generate
    depends_on: [script_problem]
    resume_output: "work/audio/problem.wav"
    script_path: "work/scripts/problem.txt"
    output_path: "work/audio/problem.wav"
    server: "{{tts_server}}"
    reference_audio: "{{reference_audio}}"
    reference_text: "{{reference_text}}"
    python_path: "{{python_path}}"

  - id: img_problem
    kind: text_to_image
    depends_on: [setup_dirs]
    resume_output: "work/images/problem.png"
    prompt: "Frustrated professional at desk, cluttered workspace, stress, landscape"
    output_path: "work/images/problem.png"
    orientation: landscape
    python_path: "{{python_path}}"

  - id: clip_problem
    kind: run_command
    depends_on: [tts_problem, img_problem]
    resume_output: "work/clips/problem.mp4"
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/problem.png", "-i", "work/audio/problem.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/problem.mp4"]

  # === Solution (20s) ===
  - id: script_solution
    kind: write_file
    depends_on: [setup_dirs]
    path: "work/scripts/solution.txt"
    content: |
      {{product}} changes everything.
      It is built from the ground up for {{audience}}.
      Simple to use. Powerful results. No complexity.

  - id: tts_solution
    kind: tts_generate
    depends_on: [script_solution]
    resume_output: "work/audio/solution.wav"
    script_path: "work/scripts/solution.txt"
    output_path: "work/audio/solution.wav"
    server: "{{tts_server}}"
    reference_audio: "{{reference_audio}}"
    reference_text: "{{reference_text}}"
    python_path: "{{python_path}}"

  - id: img_solution
    kind: text_to_image
    depends_on: [setup_dirs]
    resume_output: "work/images/solution.png"
    prompt: "Clean modern software interface, happy user, bright lighting, landscape"
    output_path: "work/images/solution.png"
    orientation: landscape
    python_path: "{{python_path}}"

  - id: clip_solution
    kind: run_command
    depends_on: [tts_solution, img_solution]
    resume_output: "work/clips/solution.mp4"
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/solution.png", "-i", "work/audio/solution.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/solution.mp4"]

  # === Features (30s) ===
  - id: script_features
    kind: write_file
    depends_on: [setup_dirs]
    path: "work/scripts/features.txt"
    content: |
      With {{product}}, you get three key capabilities.
      First, automated workflows that save you hours every week.
      Second, intelligent insights that help you make better decisions.
      Third, seamless integration with tools you already use.

  - id: tts_features
    kind: tts_generate
    depends_on: [script_features]
    resume_output: "work/audio/features.wav"
    script_path: "work/scripts/features.txt"
    output_path: "work/audio/features.wav"
    server: "{{tts_server}}"
    reference_audio: "{{reference_audio}}"
    reference_text: "{{reference_text}}"
    python_path: "{{python_path}}"

  - id: img_features
    kind: text_to_image
    depends_on: [setup_dirs]
    resume_output: "work/images/features.png"
    prompt: "Three icons representing automation, insights, integration, clean modern design, landscape"
    output_path: "work/images/features.png"
    orientation: landscape
    python_path: "{{python_path}}"

  - id: clip_features
    kind: run_command
    depends_on: [tts_features, img_features]
    resume_output: "work/clips/features.mp4"
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/features.png", "-i", "work/audio/features.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/features.mp4"]

  # === CTA (10s) ===
  - id: script_cta
    kind: write_file
    depends_on: [setup_dirs]
    path: "work/scripts/cta.txt"
    content: |
      Ready to transform the way you work?
      Try {{product}} free for fourteen days.
      Visit our website to get started today.

  - id: tts_cta
    kind: tts_generate
    depends_on: [script_cta]
    resume_output: "work/audio/cta.wav"
    script_path: "work/scripts/cta.txt"
    output_path: "work/audio/cta.wav"
    server: "{{tts_server}}"
    reference_audio: "{{reference_audio}}"
    reference_text: "{{reference_text}}"
    python_path: "{{python_path}}"

  - id: img_cta
    kind: create_slide
    depends_on: [setup_dirs]
    resume_output: "work/images/cta.png"
    template: title
    text: "Start Free Trial"
    subtext: "14 days, no credit card required"
    output_path: "work/images/cta.png"
    orientation: landscape

  - id: clip_cta
    kind: run_command
    depends_on: [tts_cta, img_cta]
    resume_output: "work/clips/cta.mp4"
    program: ffmpeg
    args: ["-y", "-loop", "1", "-i", "work/images/cta.png", "-i", "work/audio/cta.wav", "-c:v", "libx264", "-tune", "stillimage", "-c:a", "aac", "-shortest", "work/clips/cta.mp4"]

  # === Outro (music only, 5s) ===
  - id: outro_slide
    kind: create_slide
    depends_on: [setup_dirs]
    resume_output: "work/images/outro.png"
    template: title
    text: "{{product}}"
    subtext: "Work smarter"
    output_path: "work/images/outro.png"
    orientation: landscape

  - id: outro_video
    kind: image_to_video
    depends_on: [outro_slide]
    resume_output: "work/clips/outro.mp4"
    input_path: "work/images/outro.png"
    output_path: "work/clips/outro.mp4"
    motion: 40

  - id: music_outro
    kind: run_command
    depends_on: [setup_dirs]
    resume_output: "work/audio/outro_music.wav"
    program: midi-cli-rs
    args: ["preset", "--mood", "calm", "--duration", "5", "-o", "work/audio/outro_music.wav"]

  # === Normalize and Mix ===
  - id: normalize_hook
    kind: normalize_volume
    depends_on: [clip_hook]
    clip_path: "work/clips/hook.mp4"

  - id: normalize_problem
    kind: normalize_volume
    depends_on: [clip_problem]
    clip_path: "work/clips/problem.mp4"

  - id: normalize_solution
    kind: normalize_volume
    depends_on: [clip_solution]
    clip_path: "work/clips/solution.mp4"

  - id: normalize_features
    kind: normalize_volume
    depends_on: [clip_features]
    clip_path: "work/clips/features.mp4"

  - id: normalize_cta
    kind: normalize_volume
    depends_on: [clip_cta]
    clip_path: "work/clips/cta.mp4"

  - id: mix_title_music
    kind: audio_mix
    depends_on: [title_video, music_intro]
    base_clip: "work/clips/title.mp4"
    overlay_audio: "work/audio/intro_music.wav"
    output_path: "work/clips/title-mixed.mp4"
    overlay_volume: -20

  - id: mix_outro_music
    kind: audio_mix
    depends_on: [outro_video, music_outro]
    base_clip: "work/clips/outro.mp4"
    overlay_audio: "work/audio/outro_music.wav"
    output_path: "work/clips/outro-mixed.mp4"
    overlay_volume: -20

  # === Final Assembly ===
  - id: concat_final
    kind: video_concat
    depends_on: [mix_title_music, normalize_hook, normalize_problem, normalize_solution, normalize_features, normalize_cta, mix_outro_music]
    clips:
      - "work/clips/title-mixed.mp4"
      - "work/clips/hook.mp4"
      - "work/clips/problem.mp4"
      - "work/clips/solution.mp4"
      - "work/clips/features.mp4"
      - "work/clips/cta.mp4"
      - "work/clips/outro-mixed.mp4"
    output_path: "output/{{project_name}}.mp4"
    reencode: true
